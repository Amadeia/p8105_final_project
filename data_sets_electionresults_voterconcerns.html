<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Testing code</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="data.html">Data Source</a>
</li>
<li>
  <a href="data_sets_electionresults_voterconcerns.html">Exploratory Data</a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="http://www.youtube.com">
    <span class="fab fa fab fa-youtube"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/Amadeia/p8105_final_project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Testing code</h1>

</div>


<div id="testing-code-for-the-final-project" class="section level1">
<h1>Testing code for the final project</h1>
<div id="to-accomplish" class="section level2">
<h2>To accomplish:</h2>
<p>-Looking through the datasets we have available -Need Google Trend data for search terms such as “Cruz” vs “Rourke” or “midterm election” to see if number of searches correlate with # votes for each candidate or # registered voters -What kind of analysis do we want to see -Review the sample final projects</p>
<p>Some links to keep in mind: <a href="https://www.cnn.com/election/2018/exit-polls/texas/senate" class="uri">https://www.cnn.com/election/2018/exit-polls/texas/senate</a> <a href="https://www.texastribune.org/2018/10/31/ut-tt-poll-texans-say-immigration-border-security-top-issues/" class="uri">https://www.texastribune.org/2018/10/31/ut-tt-poll-texans-say-immigration-border-security-top-issues/</a></p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
## ✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(rvest)</code></pre>
<pre><code>## Loading required package: xml2</code></pre>
<pre><code>## 
## Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     pluck</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     guess_encoding</code></pre>
<pre class="r"><code>library(httr)
library(ggridges)</code></pre>
<pre><code>## 
## Attaching package: &#39;ggridges&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     scale_discrete_manual</code></pre>
</div>
<div id="scraping-election-results-from-the-web" class="section level2">
<h2>scraping election results from the web</h2>
<div id="new-york-times-voting-results-by-county" class="section level3">
<h3>New York Times voting results by county</h3>
<pre class="r"><code>url = &quot;https://www.nytimes.com/elections/results/texas-senate&quot;
nytimes_data = read_html(url, col_types = &quot;ccdd&quot;)

nytimes_data</code></pre>
<pre><code>## {xml_document}
## &lt;html lang=&quot;en&quot; itemscope=&quot;&quot; xmlns:og=&quot;http://opengraphprotocol.org/schema/&quot; itemtype=&quot;http://schema.org/NewsArticle&quot;&gt;
## [1] &lt;head&gt;\n&lt;title&gt;Texas Senate Election Results: Beto O’Rourke vs. Ted  ...
## [2] &lt;body class=&quot;eln-race-page eln-2018-11-06 eln-forecast&quot;&gt;\n&lt;script ty ...</code></pre>
<pre class="r"><code>nytimes_data %&gt;% 
  html_nodes(css = &quot;table&quot;)</code></pre>
<pre><code>## {xml_nodeset (2)}
## [1] &lt;table class=&quot;eln-table eln-results-table&quot;&gt;\n&lt;thead&gt;&lt;tr&gt;\n&lt;th class= ...
## [2] &lt;table class=&quot;eln-table eln-county-table&quot;&gt;\n&lt;thead&gt;&lt;tr&gt;\n&lt;th class=&quot; ...</code></pre>
<p>This seems to have created two tables from the website data.</p>
<pre class="r"><code>table_overall = (nytimes_data %&gt;% html_nodes(css = &quot;table&quot;)) %&gt;% 
  .[[1]] %&gt;%
  html_table()</code></pre>
</div>
</div>
<div id="tidying-overall-table-for-exploratory-analysis" class="section level2">
<h2>Tidying overall table for exploratory analysis</h2>
<pre class="r"><code>#remove the commas in the numbers first
table_overall$Votes &lt;- gsub(&quot;,&quot;,&quot;&quot;,table_overall$Votes)
table_overall$Pct. &lt;- gsub(&quot;%&quot;,&quot;&quot;,table_overall$Pct.)

#convert votes and percent to numeric
table_overall = 
  table_overall %&gt;% 
  mutate(Votes = as.numeric(Votes), Pct. = as.numeric(Pct.))</code></pre>
</div>
<div id="bar-plot-of-votes-per-candidate" class="section level2">
<h2>Bar Plot of Votes per Candidate</h2>
<pre class="r"><code>bar_overall =
  table_overall %&gt;% 
  mutate(Candidate = as.factor(Candidate)) %&gt;% 
  mutate(Candidate = forcats::fct_reorder(Candidate, Votes)) %&gt;% 
  ggplot(aes(x = Candidate, y = Votes, fill = Party)) +
  geom_bar(stat = &quot;identity&quot;) +
  labs(
    title = &quot;Number of Votes per Candidate&quot;,
    x = &quot;Candidate&quot;,
    y = &quot;Number of Votes&quot;
  ) +
  scale_x_discrete(labels = c(&quot;Cruz* Ted Cruz*&quot; = &quot;Ted Cruz&quot;, &quot;O&#39;Rourke Beto O&#39;Rourke&quot; = &quot;Beto O&#39;Rourke&quot;,
                              &quot;Dikeman Neal Dikeman&quot; = &quot;Neal Dikeman&quot;))
  
bar_overall</code></pre>
<p><img src="data_sets_electionresults_voterconcerns_files/figure-html/bar_plot-1.png" width="672" /></p>
<p>Made the first table that which we have final results for the state of texas.</p>
<pre class="r"><code>table_county =  (nytimes_data %&gt;% html_nodes(css = &quot;table&quot;)) %&gt;% 
  .[[2]] %&gt;%
  html_table() %&gt;% 
  slice(1:(n() - 1)) %&gt;% 
  select(-Rpt.) %&gt;% 
  janitor::clean_names()</code></pre>
</div>
<div id="tidying-county-table" class="section level2">
<h2>Tidying county table</h2>
<pre class="r"><code>#remove the commas in the numbers first
table_county$cruz &lt;- gsub(&quot;,&quot;,&quot;&quot;,table_county$cruz)
table_county$o_rourke &lt;- gsub(&quot;,&quot;,&quot;&quot;,table_county$o_rourke)
table_county$dikeman &lt;- gsub(&quot;,&quot;,&quot;&quot;,table_county$dikeman)

table_county = 
  table_county %&gt;% 
  mutate(cruz = as.numeric(cruz), o_rourke = as.numeric(o_rourke), dikeman = as.numeric(dikeman))

table_county$county = str_replace(table_county$county,&quot;La Vaca&quot;, &quot;Lavaca&quot;)
table_county$county = str_replace(table_county$county,&quot;De Witt&quot;, &quot;DeWitt&quot;)
#county names misspelled (was causing issues with merging later on)
table_county_long = gather(table_county, key = candidate, value = votes, cruz:dikeman)</code></pre>
<p>Made the second table which has all of the 254 county level data for Texas!</p>
</div>
<div id="plots-for-all-counties" class="section level2">
<h2>Plots for all counties</h2>
<pre class="r"><code>point_county =
  table_county_long %&gt;% 
  filter(candidate != &quot;dikeman&quot;) %&gt;% 
  ggplot(aes(x = county, y = votes, color = candidate)) +
  geom_point() +
  labs(
    title = &quot;Number of Votes for Beto vs Cruz&quot;,
    x = &quot;County&quot;,
    y = &quot;Number of Votes&quot;
  ) +
  theme(axis.text.x = element_text(angle = 90), text = element_text(size = 3))
  
point_county</code></pre>
<p><img src="data_sets_electionresults_voterconcerns_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>ggplot(table_county_long, aes(x = candidate, y = votes)) + geom_boxplot()</code></pre>
<p><img src="data_sets_electionresults_voterconcerns_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>ggplot(table_county_long, aes(x = votes, y = candidate)) + 
  geom_density_ridges(scale = .85)</code></pre>
<pre><code>## Picking joint bandwidth of 1080</code></pre>
<p><img src="data_sets_electionresults_voterconcerns_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
</div>
<div id="comparing-these-county-level-election-results-to-highly-searched-voter-election-interests-in-google" class="section level2">
<h2>comparing these county level election results to highly searched voter election interests in google</h2>
<p>-using search terms “Midterms” and selecting dataset from top result</p>
<pre class="r"><code>district_searches = read_csv(file =  &quot;./data/Search_Data_US_Congressional_District_04Nov2018.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   District = col_character(),
##   Code = col_character(),
##   State = col_character(),
##   FIRST = col_character(),
##   SECOND = col_character(),
##   THIRD = col_character(),
##   FOURTH = col_character(),
##   FIFTH = col_character(),
##   SIXTH = col_character(),
##   SEVENTH = col_character(),
##   EIGHTH = col_character(),
##   NINTH = col_character(),
##   TENTH = col_character(),
##   `Gender workplace diversity` = col_integer(),
##   `Maternity leave in the United States` = col_integer(),
##   `Single-payer healthcare` = col_integer(),
##   `Tax Cuts and Jobs Act of 2017` = col_integer(),
##   `Transgender people in the military` = col_integer()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>TX_searches = 
  district_searches %&gt;% janitor::clean_names() %&gt;% 
  filter(state == &quot;TX&quot;)

TX_counts = 
  TX_searches %&gt;% 
  count(fifth)

#select only some variables: immigration, health care, Medicare, Medicaid 
#first most searched: immigration, health care, islam, Medicare
#second most searched: health care, immigration, Medicaid, Medicare, Mental Health, Offshore bank
#third most searched: Medicare, Islam, Medicaid, Mental health, Social security, September 11 attacks, Electoral college, Climate change
#4th most searched: Medicaid, Medicare, Abortion...
#5th most searched: Medicaid, Mental health, Abortion, Islam...
#based on this, we should select variables immigration, health care, islam, Medicare, Medicaid, Mental health, and Abortion. The others can be combined as &quot;other&quot;</code></pre>
</div>
<div id="looking-at-searches-for-texas-but-for-september-26-2018-registration-ends-oct-9" class="section level2">
<h2>Looking at searches for Texas but for September 26, 2018 (registration ends Oct 9)</h2>
<p>-I’m a little confused as to the variables… I assume first means the most searched topic… and so forth for each district</p>
<pre class="r"><code>district_searches2 = read_csv(file =  &quot;./data/Search_Data_US_Congressional_District_26Sep2018.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   District = col_character(),
##   Code = col_character(),
##   State = col_character(),
##   FIRST = col_character(),
##   SECOND = col_character(),
##   THIRD = col_character(),
##   FOURTH = col_character(),
##   FIFTH = col_character(),
##   SIXTH = col_character(),
##   SEVENTH = col_character(),
##   EIGHTH = col_character(),
##   NINTH = col_character(),
##   TENTH = col_character(),
##   `Maternity leave in the United States` = col_integer(),
##   `Single-payer healthcare` = col_integer(),
##   `Tax Cuts and Jobs Act of 2017` = col_integer(),
##   `Transgender people in the military` = col_integer()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>TX_searches2 = 
  district_searches2 %&gt;% janitor::clean_names() %&gt;% 
  filter(state == &quot;TX&quot;)

TX_counts2 = 
  TX_searches2 %&gt;% 
  count(fifth)


#the topics that were searched most were health care, immigration, mental health, united nations
#second most searched: immigration, health care, Medicare, Medicaid, capital punishment
#third most searched: Medicare, Medicaid, September 11 attacks, immigration, 
#fourth most searched: Medicaid, Medicare, Immigration...
#fifth: Medicaid, mental health, Medicare, September 11 attacks...
#Thus, we should focus on the variables health care, immigration, Medicare, Medicaid, Mental health, September 11 attacks</code></pre>
</div>
<div id="uploading-county-congressional-district-txt-file" class="section level2">
<h2>uploading county congressional district txt file</h2>
<pre class="r"><code>congress_district = read.csv(file = &quot;./data/congress_district2.csv&quot;) 

congress_district$county_name = str_replace(congress_district$county_name,&quot;Sterlin&quot;, &quot;Sterling&quot;)
congress_district$county_name = str_replace(congress_district$county_name,&quot;MuCulloch&quot;,&quot;McCulloch&quot;)
#misspelled counties discovered while exploring data when merging later on</code></pre>
<pre class="r"><code>TX_searches2 =
  TX_searches2 %&gt;% 
  separate(code, into = c(&quot;remove_1&quot;, &quot;district_num&quot;), sep = &quot;-&quot;) %&gt;% 
  mutate(district_num = as.numeric(district_num)) %&gt;% 
  select(district_num, most_searched = first, everything()) 

nested_congress =
  congress_district %&gt;% 
  nest(county_name) 
    
merged_searches= merge(TX_searches2, nested_congress, by=&quot;district_num&quot;, all=TRUE) %&gt;% 
  unnest() 

#rename variable county_name
merged_searches2 = merged_searches %&gt;% 
  select(district_num, county=county_name, everything())

merged_nyt_searches = merge(merged_searches2, table_county, by= &quot;county&quot;, all=TRUE)</code></pre>
</div>
</div>
<div id="plot-for-topics-search-per-county" class="section level1">
<h1>plot for topics search per county</h1>
<p>Still figuring out how to display this ideas: 1) interactive barchart in the current long format, if we use shiny we could show how the top topics vary among counties through use of drop-down menu to select county, etc. 2) figure out we can juxtapose how the counties voted vs. topics. Use of plotly for interactivity? 3) Alternative to first option, how can we show the distribution of topics among counties instead? 4)focus on 5 biggest counties or districts? but this would be biased as it may be a metropolitan area</p>
<pre class="r"><code>merged_nyt_searches_long = gather(merged_nyt_searches, key = topics, value = search_interest, health_care:september_11_attacks)</code></pre>
<div id="comparing-these-county-level-election-results-to-search-results-by-candidate" class="section level2">
<h2>comparing these county level election results to search results by candidate</h2>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
